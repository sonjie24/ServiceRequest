<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Print Service Request</title>
  <style>
   body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    td, th {
      border: 1px solid #000;
      padding: 4px 6px;
      vertical-align: top;
    }
    .no-border {
      border: none;
    }
    .section-title {
      font-weight: bold;
      text-align: center;
      background-color: #f2f2f2;
    }
    .signature-block td {
      height: 40px;
      text-align: center;
    }
    .checkbox-cell {
      width: 30px;
      text-align: center;
    }
    .small {
      font-size: 12px;
    }
    button {
      margin-top: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    @media print {
      button {
        display: none;
      }
    }
  </style>
</head>
<body>
<h2 style="text-align:center;">SERVICE REQUEST FORM</h2>

  <table>
    <tr>
      <td>DATE REQUESTED:</td>
      <td colspan="2"></td>
      <td>SERVICE REQUEST #:</td>
      <td><a href="#">CNIMS-2025-07-0006</a></td>
    </tr>
    <tr>
      <td>DEPARTMENT:</td>
      <td colspan="2"></td>
      <td>MODULE:</td>
      <td></td>
    </tr>
    <tr>
      <td>FORM #:</td>
      <td>Sample</td>
      <td>SYSTEM FORM NAME:</td>
      <td colspan="2"></td>
    </tr>
  </table>

  <br>

  <table>
    <tr class="section-title">
      <td colspan="3">CONCERN TYPE</td>
      <td colspan="2">LEVEL OF PRIORITY</td>
    </tr>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td colspan="2">New (Function/Field/Entry/Column/Row)</td>
      <td class="checkbox-cell">‚òê</td>
      <td>Basic - Committed Date:</td>
    </tr>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td colspan="2">Revision (Enhancement of Existing)</td>
      <td class="checkbox-cell">‚òê</td>
      <td>Immediate</td>
    </tr>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td colspan="2">Delete (Dropped Query/Function/Row/Column/Data Point)</td>
      <td class="checkbox-cell">‚òê</td>
      <td>Addtl Customization/Outside Scope</td>
    </tr>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td colspan="4">Cosmetic (Fonts/Color/Header/Footer)</td>
    </tr>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td colspan="4">Data (Override/Deletion)</td>
    </tr>
  </table>

  <br>

  <table>
    <tr class="section-title">
      <td>DATA POINTS</td>
      <td>REFERENCE DATA FIELD</td>
    </tr>
    <tr><td>1)</td><td></td></tr>
    <tr><td>2)</td><td></td></tr>
    <tr><td>3)</td><td></td></tr>
    <tr><td>4)</td><td></td></tr>
    <tr><td>5)</td><td></td></tr>
    <tr>
      <td colspan="2" class="small"><i>Note: Additional concerns may be written on the back page.</i></td>
    </tr>
  </table>

  <br>

  <table class="signature-block">
    <tr>
      <td>USER</td>
      <td>DEPARTMENT HEAD</td>
      <td>IT HEAD</td>
    </tr>
    <tr>
      <td></td>
      <td>RICHARD PORRAS</td>
      <td>ROMEO B. EMPLEO JR.</td>
    </tr>
    <tr>
      <td>INTEGRATOR</td>
      <td>DEVELOPER</td>
      <td>QA</td>
    </tr>
    <tr>
      <td></td><td></td><td></td>
    </tr>
  </table>

  <br>

  <table>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td>Print Out as per User Request</td>
      <td>Date:</td>
    </tr>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td>Current System Print Out</td>
      <td>Date:</td>
    </tr>
    <tr>
      <td class="checkbox-cell">‚òê</td>
      <td>Modified/Revised Print Out</td>
      <td>Patch Installed On:</td>
    </tr>
  </table>

  <button onclick="window.print()">üñ®Ô∏è Print</button>

  <script src="../js/config.js"></script>
  <script>
    async function loadPrintData() {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");

      if (!id) {
        alert("Missing request ID.");
        return;
      }

      try {
        const res = await fetch(`${API_BASE_URL}/get-one`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ service_request_no: id })
        });

        const json = await res.json();
        const record = json.data;

        if (!record) {
          alert("Request not found.");
          return;
        }

        // Fill table fields
        document.getElementById("req_no").textContent = record.service_request_no || "-";
        document.getElementById("date_requested").textContent = record.date_requested || "-";
        document.getElementById("module").textContent = record.module || "-";
        document.getElementById("form").textContent = record.system_form_name || "-";
        document.getElementById("concern").textContent = record.concern || "-";

        // Auto-print after DOM updates
        setTimeout(() => {
          requestAnimationFrame(() => window.print());
        }, 300);

      } catch (err) {
        console.error("Failed to load print data:", err);
        alert("Something went wrong loading the request.");
      }
    }

    window.addEventListener("DOMContentLoaded", loadPrintData);
  </script>
</body>
</html>
